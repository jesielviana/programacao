<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/programacao-para-internet-i/styles.0263a7a090c5769c40ba.css">@import url(https://fonts.googleapis.com/css?family=Work+Sans:400,700);code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body,html{font-family:Work Sans,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{text-decoration:none;background-color:transparent;-webkit-text-decoration-skip:objects}a,a:active,a:focus,a:hover,a:visited{color:#19508e}a:active,a:hover{outline-width:0;text-decoration:underline}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible;width:100%;display:block}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem;overflow-y:visible;overflow-x:auto}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}</style><meta name="generator" content="Gatsby 2.20.12"/><title data-react-helmet="true">TADS 2020 | Homework 5: Piazza Lite</title><meta data-react-helmet="true" name="description" content="Student-taught 19X course on JavaScript web development at the University of Pennsylvania."/><meta data-react-helmet="true" property="og:title" content="Homework 5: Piazza Lite"/><meta data-react-helmet="true" property="og:description" content="Student-taught 19X course on JavaScript web development at the University of Pennsylvania."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Cameron Cabo &lt;ccabo@seas.upenn.edu&gt;"/><meta data-react-helmet="true" name="twitter:title" content="Homework 5: Piazza Lite"/><meta data-react-helmet="true" name="twitter:description" content="Student-taught 19X course on JavaScript web development at the University of Pennsylvania."/><meta data-react-helmet="true" property="twitter:image"/><style data-styled="ealrCq cdJxCD iSdMQU igtEjC jPZtZS eiABl dMkSNv iOQZld bIEPXk DJKpY jgHiMv ehTWzq hsiMIB gZmsVQ iOLuiv fbBSou bvDASM exNhrp" data-styled-version="4.4.1">
/* sc-component-id: Links-sc-1lx20av-0 */
@media screen and (max-width:992px){.eiABl{max-height:0;}.eiABl a{display:block;margin:0.5rem 0;font-size:1.2rem;}}
/* sc-component-id: Links__InternalLink-sc-1lx20av-1 */
.dMkSNv{width:100%;color:#8C8D91;-webkit-text-decoration:none !important;text-decoration:none !important;width:100%;display:block;padding:0.5rem 0;} .dMkSNv:visited{color:#8C8D91;} .dMkSNv:active,.dMkSNv:focus,.dMkSNv:hover{color:#47484C;} .dMkSNv:active::after,.dMkSNv:focus::after,.dMkSNv:hover::after{content:"→";float:right;}
/* sc-component-id: Links__ExternalLink-sc-1lx20av-2 */
.iOQZld{width:100%;color:#8C8D91;-webkit-text-decoration:none !important;text-decoration:none !important;width:100%;display:block;padding:0.5rem 0;} .iOQZld:visited{color:#8C8D91;} .iOQZld:active,.iOQZld:focus,.iOQZld:hover{color:#47484C;} .iOQZld:active::after,.iOQZld:focus::after,.iOQZld:hover::after{content:"→";float:right;}
/* sc-component-id: Footer__Wrapper-pau7fb-0 */
@media screen and (max-width:992px){.bIEPXk{max-height:0;}}
/* sc-component-id: Footer-pau7fb-1 */
.DJKpY{width:100%;padding:1rem 0;color:#8C8D91;font-size:0.8rem;position:absolute;bottom:1rem;} @media screen and (max-width:992px){.DJKpY{position:relative;padding:1rem 0 0 0;bottom:0;}}
/* sc-component-id: Footer__ExternalLink-pau7fb-2 */
.jgHiMv{width:100%;padding:1rem 0;color:#8C8D91;font-size:0.7rem;position:absolute;display:block;bottom:0;} @media screen and (max-width:992px){.jgHiMv{position:relative;padding:0;display:block;}}
/* sc-component-id: Bars__Wrapper-sc-1no3yli-0 */
.iSdMQU{padding:10px 1rem;cursor:pointer;position:absolute;right:0;top:0.5rem;} .iSdMQU:hover{opacity:0.5;} @media screen and (min-width:992px){.iSdMQU{display:none;}}
/* sc-component-id: Bars__Bar-sc-1no3yli-1 */
.igtEjC{width:16px;height:2px;margin-bottom:3px;display:block;background:#000;}
/* sc-component-id: Header__Nav-sc-1yg5ab7-0 */
.cdJxCD{position:fixed;width:20%;padding:calc(1rem + 2.5%) 1rem;border-right:1px solid rgba(0,0,0,0.1);min-height:100vh;overflow-y:auto;overflow-x:hidden;} @media screen and (max-width:992px){.cdJxCD{width:100%;padding:0.5rem 1rem;border-right:0;border-bottom:1px solid rgba(0,0,0,0.1);min-height:0;z-index:1300;background:#FFF;overflow-y:hidden;max-height:53px;}}
/* sc-component-id: Header__NavSpacer-sc-1yg5ab7-1 */
.ehTWzq{width:20%;} @media screen and (max-width:992px){.ehTWzq{width:100%;height:53px;}}
/* sc-component-id: Header__LogoText-sc-1yg5ab7-2 */
.jPZtZS{color:#000 !important;-webkit-text-decoration:none !important;text-decoration:none !important;font-size:2rem;font-weight:bold;margin-bottom:1.5rem;display:block;} @media screen and (max-width:992px){.jPZtZS{display:inline-block;vertical-align:top;margin-top:0.375rem;margin-bottom:0;font-size:1.25rem;}}
/* sc-component-id: Breadcrumbs-sc-17kbl3t-0 */
.gZmsVQ{display:inline-block;margin-bottom:1.5rem;background:#f4f5f7;padding:0.5rem 0 0.5rem 1rem;border-radius:4px;} .gZmsVQ a{margin-right:1rem;color:#8C8D91 !important;-webkit-text-decoration:none;text-decoration:none;font-size:0.8rem;} .gZmsVQ a:hover,.gZmsVQ a:focus,.gZmsVQ a:active{color:#47484C !important;-webkit-text-decoration:none;text-decoration:none;}
/* sc-component-id: Breadcrumbs__Home-sc-17kbl3t-1 */
.iOLuiv{height:0.8rem;width:0.8rem;display:inline-block;margin:0;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxMDAgODkuOCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTAwIDg5Ljg7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojOEM4RDkxO30KPC9zdHlsZT4KPHRpdGxlPkhvbWU8L3RpdGxlPgo8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMTAwLDQxLjFjMC4xLTMuMy0xLjQtNi41LTQuMS04LjRjLTEyLjktMTAtMjUuOC0yMC0zOC43LTMwLjFDNTMtMC45LDQ3LTAuOSw0Mi45LDIuNgoJYy0xMywxMC4xLTI2LDIwLjItMzguOSwzMC4zYy0xLjgsMS4zLTMuMSwzLjMtMy42LDUuNUMwLjEsNDAuMiwwLDQyLDAsNDMuOGMtMC4xLDQuMiwyLjMsNi43LDYuNiw2LjdjMi4xLDAsNC4zLDAsNi41LDB2Mi4yCgljMCw0LjgsMCw5LjUsMCwxNC4zdjExLjZjMCwwLjEsMCwwLjIsMCwwLjJjMCwwLjUsMCwxLDAsMS41YzAsNS4yLDQuMiw5LjUsOS41LDkuNWMwLDAsMCwwLDAuMSwwaDExLjloMmMwLjMsMCwwLjUsMCwwLjgsMGgzOS44CgljNS4yLDAuMSw5LjYtNC4xLDkuNy05LjNjMC0wLjEsMC0wLjMsMC0wLjRjMC0wLjUsMC0xLDAtMS40YzAsMCwwLTAuMSwwLTAuMlY2NS45YzAsMCwwLTAuMSwwLTAuMWMwLTQuNSwwLTksMC0xMy41di0xLjgKCWMyLjQsMCw0LjYsMCw2LjgsMGMzLjMsMC4yLDYuMS0yLjQsNi4zLTUuN2MwLTAuMiwwLTAuNCwwLTAuNkMxMDAsNDMuMiwxMDAsNDIuMiwxMDAsNDEuMXoiLz4KPC9zdmc+Cg==);opacity:0.8;background-position:center;background-repeat:no-repeat;background-size:contain;} .iOLuiv:hover{opacity:1;}
/* sc-component-id: Breadcrumbs__Chevron-sc-17kbl3t-2 */
.fbBSou{height:0.8rem;width:0.4rem;display:inline-block;margin:0 1rem 0 0;opacity:0.5;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAyNyA0NyIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjcgNDc7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojOEM4RDkxO30KPC9zdHlsZT4KPHRpdGxlPkV4dHJhIEV4dHJhIEJvbGQgQ2hldnJvbiBMZWZ0PC90aXRsZT4KPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CjxnPgoJPGc+CgkJPHBhdGggY2xhc3M9InN0MCIgZD0iTTEsNDFjLTEuNCwxLjQtMS40LDMuNiwwLDQuOWMxLjQsMS40LDMuNiwxLjQsNC45LDBsMjAtMjBjMS40LTEuNCwxLjQtMy42LDAtNC45TDYsMUM0LjYtMC4zLDIuNC0wLjMsMSwxCgkJCUMtMC4zLDIuNC0wLjMsNC42LDEsNmwxNy41LDE3LjVMMSw0MXoiLz4KCTwvZz4KPC9nPgo8L3N2Zz4K);background-position:center;background-repeat:no-repeat;background-size:contain;}
/* sc-component-id: Breadcrumbs__StyledLink-sc-17kbl3t-3 */
.bvDASM{text-transform:capitalize;}
/* sc-component-id: Layout__Wrapper-lyeqhw-0 */
.ealrCq{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;} @media screen and (max-width:992px){.ealrCq{display:block;}}
/* sc-component-id: Layout__Content-lyeqhw-1 */
.hsiMIB{-webkit-flex:1;-ms-flex:1;flex:1;padding:calc(1rem + 2.5%) calc(5% + 1rem);min-height:calc(100vh - 60px);display:block;box-sizing:border-box;position:relative;width:80vw;} @media screen and (max-width:992px){.hsiMIB{width:100%;}} .hsiMIB hr{background:rgba(0,0,0,0.1);height:3px;} .hsiMIB pre{max-width:100%;background:#f4f5f7 !important;margin:0;margin-bottom:1.45rem;} .hsiMIB pre .token.operator{background:#f4f5f7 !important;} .hsiMIB pre::before{content:'' !important;display:none;} .hsiMIB pre::after{content:'' !important;display:none;} .hsiMIB pre code{padding:0 !important;} .hsiMIB code{background:#f4f5f7 !important;line-height:1.45rem;padding:0.1em 0.3em !important;} .hsiMIB code::before{content:'' !important;display:none;} .hsiMIB code::after{content:'' !important;display:none;} .hsiMIB tbody tr:hover{background:#f4f5f7;}
/* sc-component-id: Markdown__Timestamp-sc-1ihrd7h-0 */
.exNhrp{color:#8C8D91;opacity:0.8;margin-bottom:calc(2rem + 2.5%);}</style><link rel="icon" href="/programacao-para-internet-i/icons/icon-48x48.png?v=241313ef2afc415e913b781f93a8a90b"/><link rel="manifest" href="/programacao-para-internet-i/manifest.webmanifest"/><meta name="theme-color" content="#000000"/><link rel="apple-touch-icon" sizes="48x48" href="/programacao-para-internet-i/icons/icon-48x48.png?v=241313ef2afc415e913b781f93a8a90b"/><link rel="apple-touch-icon" sizes="72x72" href="/programacao-para-internet-i/icons/icon-72x72.png?v=241313ef2afc415e913b781f93a8a90b"/><link rel="apple-touch-icon" sizes="96x96" href="/programacao-para-internet-i/icons/icon-96x96.png?v=241313ef2afc415e913b781f93a8a90b"/><link rel="apple-touch-icon" sizes="144x144" href="/programacao-para-internet-i/icons/icon-144x144.png?v=241313ef2afc415e913b781f93a8a90b"/><link rel="apple-touch-icon" sizes="192x192" href="/programacao-para-internet-i/icons/icon-192x192.png?v=241313ef2afc415e913b781f93a8a90b"/><link rel="apple-touch-icon" sizes="256x256" href="/programacao-para-internet-i/icons/icon-256x256.png?v=241313ef2afc415e913b781f93a8a90b"/><link rel="apple-touch-icon" sizes="384x384" href="/programacao-para-internet-i/icons/icon-384x384.png?v=241313ef2afc415e913b781f93a8a90b"/><link rel="apple-touch-icon" sizes="512x512" href="/programacao-para-internet-i/icons/icon-512x512.png?v=241313ef2afc415e913b781f93a8a90b"/><link as="script" rel="preload" href="/programacao-para-internet-i/app-9cbc32572977ab7faa41.js"/><link as="script" rel="preload" href="/programacao-para-internet-i/component---src-templates-markdown-js-69fedeea123282261fbd.js"/><link as="script" rel="preload" href="/programacao-para-internet-i/commons-2d3c9d9b2e097061f5b5.js"/><link as="script" rel="preload" href="/programacao-para-internet-i/styles-36681512479a843831b0.js"/><link as="script" rel="preload" href="/programacao-para-internet-i/framework-e43bc979b16dd68f6b5c.js"/><link as="script" rel="preload" href="/programacao-para-internet-i/webpack-runtime-bf342d3b34a971271ccc.js"/><link as="fetch" rel="preload" href="/programacao-para-internet-i/page-data/assignments/5/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/programacao-para-internet-i/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout__Wrapper-lyeqhw-0 ealrCq"><nav class="Header__Nav-sc-1yg5ab7-0 cdJxCD"><div class="Bars__Wrapper-sc-1no3yli-0 iSdMQU"><span class="Bars__Bar-sc-1no3yli-1 igtEjC"></span><span class="Bars__Bar-sc-1no3yli-1 igtEjC"></span><span class="Bars__Bar-sc-1no3yli-1 igtEjC"></span></div><a class="Header__LogoText-sc-1yg5ab7-2 jPZtZS" href="/programacao-para-internet-i/">TADS 2020</a><div class="Links-sc-1lx20av-0 eiABl"><a class="Links__InternalLink-sc-1lx20av-1 dMkSNv" href="/programacao-para-internet-i/">Home</a><a class="Links__InternalLink-sc-1lx20av-1 dMkSNv" href="/programacao-para-internet-i/assignments">Assignments</a><a class="Links__InternalLink-sc-1lx20av-1 dMkSNv" href="/programacao-para-internet-i/lectures">Lectures</a><a class="Links__InternalLink-sc-1lx20av-1 dMkSNv" href="/programacao-para-internet-i/staff">Staff</a><a href="https://piazza.com/class/jr6qcpostx35b8" target="_BLANK" class="Links__ExternalLink-sc-1lx20av-2 iOQZld">Piazza</a></div><div class="Footer__Wrapper-pau7fb-0 bIEPXk"><footer class="Footer-pau7fb-1 DJKpY">Prof. Jesiel Viana © <!-- -->2020</footer><a href="https://github.com/cacabo" target="_BLANK" class="Footer__ExternalLink-pau7fb-2 jgHiMv">Power By @cameroncabo</a></div></nav><div class="Header__NavSpacer-sc-1yg5ab7-1 ehTWzq"></div><div class="Layout__Content-lyeqhw-1 hsiMIB"><div class="Breadcrumbs-sc-17kbl3t-0 gZmsVQ"><a href="/programacao-para-internet-i/"><div class="Breadcrumbs__Home-sc-17kbl3t-1 iOLuiv"></div></a><span><div class="Breadcrumbs__Chevron-sc-17kbl3t-2 fbBSou"></div><a class="Breadcrumbs__StyledLink-sc-17kbl3t-3 bvDASM" href="/programacao-para-internet-i/assignments">assignments</a></span><span><div class="Breadcrumbs__Chevron-sc-17kbl3t-2 fbBSou"></div><a aria-current="page" class="Breadcrumbs__StyledLink-sc-17kbl3t-3 bvDASM" href="/programacao-para-internet-i/assignments/5">5</a></span></div><h1>Homework 5: Piazza Lite</h1><p class="Markdown__Timestamp-sc-1ihrd7h-0 exNhrp">Last updated: <!-- -->January 29, 2019</p><div><h3>Download:</h3>
<p>Download the implementation stub <a href="/programacao-para-internet-i/~cis197/assignments/build/CIS197_HW5NEW.zip">here</a>.</p>
<p>Disclaimer: This homework will be really guided so it is important to read  through the writeup as you code along. Furthermore, there are no automated tests on this HW, but rather we will expect you to put up a running instance of your web app and we will expect to see some functionality.</p>
<p>Est time: 4-5 hrs if no previous web dev experience. 2-3 hrs if previous experience.</p>
<h2>Final Product</h2>
<p><img src="https://media.giphy.com/media/7OWsDBLtjSKNbtRenC/giphy.gif"></p>
<p>Our final application will be a really pared down version of piazza ("pared down" is an understatement) that allows you to list out a bunch of questions that only registered users have submitted. That being said, there is also a signup/login portion of this website with a persistent database.</p>
<p>You can play around with a working version <a href="https://pacific-scrubland-24669.herokuapp.com/">here</a></p>
<p>With that idea in mind, let's dive in.</p>
<h3>Server.js</h3>
<p>First off, this application will be an express application. So it'd be wise to probably do something along the lines of <code class="language-text">npm install -s express</code>  and to require it in your server.js file. Note that requiring a module looks like</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> moduleNameHere <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'module-name-here'</span><span class="token punctuation">)</span></code></pre></div>
<p>In the case of express it will be</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">var express = require(&#39;express&#39;)</code></pre></div>
<p>Great. We will also need to instantiate our express application by including the line <code class="language-text">var app = express()</code> somewhere in our code (we've already done that for you).</p>
<p>For now, comment out the <code class="language-text">mongoose.connect(...)</code> line. We'll get to that later.</p>
<p>Also comment out the <code class="language-text">app.engine(...)</code> and <code class="language-text">app.set(...)</code> lines.</p>
<p>We've set up a couple of routes for you. <code class="language-text">app.get(&#39;/&#39;, ...)</code> and <code class="language-text">app.post(&#39;/&#39;, ...)</code>. Those are there for you to handle requests that happen on the base url itself (in our case, localhost).</p>
<p>We've also set up an <code class="language-text">app.listen</code> call that specifies our application listens on port process.env.PORT or port 3000. Since we haven't set process.env.PORT on our command line it will default over to port 3000.</p>
<p>Let's run <code class="language-text">node server.js</code> and visit <code class="language-text">localhost:3000</code>...what do we see?</p>
<p>Probably nothing. That is because we haven't specified anything to happen in our GET <code class="language-text">/</code> route handler. For now, just specify that it should just output <code class="language-text">hello world</code>.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Now, if quit and re-run <code class="language-text">node server.js</code> we should see <code class="language-text">hello world</code> outputted in our browser window at <code class="language-text">localhost:3000</code>.</p>
<p>Great. Now let's encode some more complicated logic. Note that we've already provided you with some html pages within <code class="language-text">views/</code>. In that file, there is an <code class="language-text">index</code> page that will eventually contain some EJS rendering logic.</p>
<p>Recall from class that whenever we want to custom render some information, we need to use a templating engine. In this case, we are using ejs. To tell express that it needs to use this, uncomment the two lines <code class="language-text">app.engine(...)</code> and <code class="language-text">app.set(...)</code>. Now, instead of doing <code class="language-text">res.send(&#39;hello world&#39;)</code> inside of the GET <code class="language-text">/</code> route, we can do a render call</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span></code></pre></div>
<p>The express rendering engine, by default, will look for a file with name <code class="language-text">index.html</code> in the <code class="language-text">views</code> directory. Since that exists, it will pass the file through the ejs renderer.</p>
<p>When you restart the server you will probably see an error...read the error and you may be able to find some part that says "Cannot find module ejs". How might we be able to fix this? (Hint hint, npm install is a thing).</p>
<p>Once you've fixed that, reload <code class="language-text">localhost:3000</code> you should see a form (with title "Question"), a text field, a button "Add question", and a link to Log In.</p>
<p>The intended behavior of the question input is to save the question text into a database and eventually display a list of questions to the user.</p>
<p>The way that we actually submit a question to the server is by typing in information into the text box and clicking submit. By default, our submit button will issue a post request to the route that exists at the route this form exists (in our case, it will submit a POST request to the <code class="language-text">/</code>  route). So...it makes sense for us to actually put in some logic to figure out  what  happens when a post request is submitted on that route.</p>
<p>Let's walk through how to handle that post request.</p>
<h2>Adding Questions</h2>
<p>To handle form submissions, we need to require a module that allows us to read from a body of a request. This module is called <code class="language-text">body-parser</code>. You'll need to run <code class="language-text">npm install -s body-parser</code> and require it in your <code class="language-text">server.js</code> file (in a similar format to above).</p>
<p>The reason why we install this new module to help us do this task is because the  request object has a bunch of different keys and properties and it is  difficult  to parse out the relevant form information if we handled everything from  scratch. The body-parser middleware will help us  instantaneously access any form information.</p>
<p>Refer to the hinted lines in <code class="language-text">server.js</code> to see how to set up the body parser middleware. What body parser does is that it intercepts all the requests and adds an additional <code class="language-text">body</code> object to the <code class="language-text">req</code> object (in your callbacks).</p>
<p>To get started with using it, create a new POST route at <code class="language-text">/</code> (it's similarly formatted to the <code class="language-text">app.get</code> call, but will need to be <em>slightly</em> different).</p>
<p>Inside of this POST route, grab the question text from when we actually submit the form. If you need help figuring out what part of the request you need to pay attention to, just try debugging a bit. The relevant information will be on the <code class="language-text">req.body</code> object.</p>
<p>As an exercise, just <code class="language-text">res.send</code> back the submitted text to the user when they submit the form. To test this out, type in some dummy info into the text box and click submit. If you get text back saying the actual text that was in the text box, you're all set up!</p>
<p>Okay...if you are stuck here, here's what the app.post route should look like:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> q <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>question<span class="token punctuation">;</span> <span class="token comment">// why is is req.body.question and not  something else?</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h4>Rendering Questions Try 1:</h4>
<p>Now we are going to try and render all the questions that users submit. Create a separate array (outside of the scope of any functions) in <code class="language-text">server.js</code>.</p>
<p>When a user submits a POST request to <code class="language-text">/</code>, add the content of their question to the array. Redirect the user back to the main page by doing <code class="language-text">res.redirect(&#39;/&#39;)</code></p>
<p>When a user submits a GET request to <code class="language-text">/</code> (i.e. just visits the site), we want to display those questions back to the user. To do so, we need to alter our <code class="language-text">res.render</code> call a bit.</p>
<p>Instead of doing <code class="language-text">res.render(&#39;index&#39;)</code> write in</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> questions<span class="token operator">:</span> questionsArray <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Since we are supplying a variable to our render call, we will need to specify to our template how to handle that rendering logic. Go to <code class="language-text">views/index.html</code> and refer to <a href="https://github.com/cis197/lecture-examples/blob/d242719987fd012c8c5ad86214c3e1d468df8a1e/server-example/views/index.html#L15">here</a> to see how you should handle iterating through the <code class="language-text">questions</code> we provide the template and, correspondingly, add list items to the page.</p>
<p>When you are done with this part, you should be able to submit new items to  the form and have them display back  to you. If you restart  the server, these items should disappear upon new page load.</p>
<p>The code at this stage  should look something like</p>
<p><strong>Server.js</strong></p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// some code up here...</span>
<span class="token keyword">var</span> questionsArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> questions<span class="token operator">:</span> questionsArray <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> q <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>question<span class="token punctuation">;</span>
  questionsArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p><strong>views/index.html</strong></p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>cis197 piazza lite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      Question: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>question<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Add question<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/account/login<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Log in<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span> to submit a question
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
      &lt;% for (q in questions) { %>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>&lt;%= questions[q] %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
      &lt;% } %>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></div>
<p>You should also be able to get  this type of behavior upon completing  this section:</p>
<p><img src="https://media.giphy.com/media/EpxhoWQvHgraH3DLGT/giphy.gif" alt="pt1"></p>
<h4>Adding a backing database to persist information:</h4>
<p>We have a slight issue with how we are storing things right now. Currently, if we actually restart our server, the <code class="language-text">questionsArray</code> value gets reset to <code class="language-text">[]</code> and we lose all the information that was stored in it. SAD!</p>
<p>We need some way of persisting that information...Perhaps using a central "base" that  stores data...A database!</p>
<p>This is now the time to look up how to install <code class="language-text">mongodb</code> for your system...and then install it.</p>
<p>Once that is done, in a separate terminal window, run <code class="language-text">mongod</code>.</p>
<p>Now go back to <code class="language-text">server.js</code>. Require in <code class="language-text">mongoose</code> (make sure you <code class="language-text">npm install -s mongoose</code>) and uncomment the line <code class="language-text">mongoose.connect(...)</code>. If you can re-run your <code class="language-text">node server.js</code> script without it crashing, you have successfully set up a mongodb connection.</p>
<p>Inside of <code class="language-text">models/question.js</code>, add a field <code class="language-text">questionText</code> of type string to your schema (use <a href="https://mongoosejs.com/docs/guide.html#definition">this</a> as reference on how to do so).</p>
<p>Okay...i'll give this to you as well:</p>
<p><strong>models/question.js</strong></p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> questionSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  questionText<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Question'</span><span class="token punctuation">,</span> questionSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Here we are setting up something called a <code class="language-text">Schema</code> (this is mongoose terminology) that basically structures all entries of type <code class="language-text">Question</code> that enter into our mongodb database. Mongoose will require that these <code class="language-text">Question</code> records have a single field  <code class="language-text">questionText</code> of type <code class="language-text">String</code>. Lastly, we export a <em>model</em> (basically the functional version of the Schema) that is preloaded with all of the fancy methods that mongoose gives to us (like <code class="language-text">.find</code> <code class="language-text">.remove</code>, etc).</p>
<p>Cool...so now how do we actually use this model?</p>
<p>At the top of <code class="language-text">server.js</code> put a line that requires the model/question.js file</p>
<p>Perhaps something like</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> Question <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./model/question'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Well...maybe we may have put in a typo in that require statement...see how you can fix that :)</p>
<p>Now, within our <code class="language-text">app.post(&#39;/&#39;)</code> route, we need some way to actually save the question we grab from the form into the database.</p>
<p>We can simply do the following:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> q <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>question<span class="token punctuation">;</span>
  <span class="token keyword">var</span> dbQ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Question</span><span class="token punctuation">(</span><span class="token punctuation">{</span> questionText<span class="token operator">:</span> q <span class="token punctuation">}</span><span class="token punctuation">)</span>
  dbQ<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'something went wrong: '</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Here  we  create a <code class="language-text">Question</code> record object (note  that  this is just  an object that hasn't been saved to the database yet). Once we have created this (with the appropriate instantiation fields), we then go through and save the question. Note that the save operation in mongoose accepts a single argument, a callback function (which is specified to have two arguments, an <code class="language-text">error</code> argument that contains any errors  that happen during  the database save operation, and the result operation that just returns the actual object that is saved). We then specify that if  there is no error, we redirect back to the home page. Otherwise, we send back the error message to  the user.</p>
<p>Great! So now that we  have all that settled, if we type something in and submit, we'll save that question to the database and it'll display on the frontend right?</p>
<p>Wrong.</p>
<p>We have to implement a database query operation in the <code class="language-text">app.get(&#39;/&#39;, ...)</code> route so that express knows to actually load up the questions stored in the database.</p>
<p>We can do that by  writing in the following into our app.get route.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> questionDb <span class="token operator">=</span> Question<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> results</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> questions<span class="token operator">:</span> results <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Okay, so <em>now</em> if we restart our server and refresh the page, we should see  what we originally saw when we had an array backing the db right?</p>
<p>Wrong :(</p>
<p><img src="https://i.imgur.com/3bL7sZM.png" alt="womp"></p>
<p>Well...we see a bunch of different fields here for each question. Recall that in our questionsArray, we only stored the text of every question. Mongoose (mongodb specifically) also adds some other attributes (in this case  <code class="language-text">_id</code> and <code class="language-text">__v</code>) that are relevant  for keeping track of things, but not relevant for us. We need to edit our <code class="language-text">views/index.html</code> to take care of this...</p>
<p><strong>TODO:</strong> modify your <code class="language-text">views/index.html</code> to only display the text of the question!</p>
<p>Once we have that done, we should see the original question we had. <em>And</em> when we restart the server, it should still persist!</p>
<p><img src="https://media.giphy.com/media/YkYtAupZiLGdcUp0c6/giphy.gif"></p>
<p>Wowee.</p>
<h3>User Login/Signup ... removing the training wheels</h3>
<p>Now, we come to the part of the application that is going to be more "homework"-y than this previous part.</p>
<p>We want to eventually "protect" our application and restrict the ability to add  questions <em>only</em> to registered users.</p>
<h4>Signup</h4>
<p>Now we need to do the following:</p>
<ul>
<li>Set up a <code class="language-text">GET</code> route for <code class="language-text">/signup</code></li>
<li>Set up a <code class="language-text">POST</code>  route for <code class="language-text">/signup</code></li>
</ul>
<p>Note that for the <code class="language-text">GET</code> route, we have already made an html page for your for signing up route. So for the <code class="language-text">GET</code> route, all you need to do is just render that page.</p>
<p>The <code class="language-text">POST</code> route will handle grabbing the information from the form submission. You will need to grab the relevant fields from the form (hint hint, use <code class="language-text">req.body.someAttributeNameHere</code> to grab the username and password  of the user from our form).</p>
<ul>
<li>Once you have that done, you need to set up a database model that actually allows the user to be registered into the database itself. This database model (look in the <code class="language-text">models/user.js</code> file), should have two fields, a <code class="language-text">username</code> field of type <code class="language-text">String</code> and <code class="language-text">password</code> field of type <code class="language-text">String</code>. Don't worry about doing uniqueness checks etc.</li>
</ul>
<p>To check and see if a user has <em>actually</em> been registered into your database, just stick a call to</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> results</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>(provided you have imported your User model under the variable <code class="language-text">User</code>) in your <code class="language-text">/signup</code> GET route. If you visit the signup route, you should see all the user records be printed out in your terminal's console.</p>
<p>Okay...I'll give this one to you (at least a part of the <code class="language-text">server.js</code> file)...</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">app.get(&#39;/signup&#39;, function (req, res, next) {
  // debug check for all signed up users...
  User.find({}, function (err, results) {
    console.log(results);
  })
  res.render(&#39;signup&#39;);
})

app.post(&#39;/signup&#39;, function (req, res, next) {
  var username = req.body.username;
  var password = req.body.password;
  var u = new User({ username: username, password: password  })
  u.save(function (err, result) {
    if (!err) {
      res.redirect(&#39;/&#39;) // just redirect back to the home page
    } else {
      res.send(err.message);
    }
  })
})</code></pre></div>
<p>You will still need to implement the <code class="language-text">models/user.js</code> file and make sure that all the "requires" are appropriate for the <code class="language-text">server.js</code> file.</p>
<h4>Login</h4>
<p>Similar todo list here</p>
<ul>
<li>GET <code class="language-text">/login</code> should just render out <code class="language-text">views/login.html</code>.</li>
<li>
<p>POST <code class="language-text">/login</code> should query our database for a <code class="language-text">username</code> and <code class="language-text">password</code> that matches the one submitted in our form (hint hint: look at the <code class="language-text">.findOne({...})</code> operation that mongoose provides to find out how to filter our database by multiple fields.</p>
<ul>
<li>If the POST request is successful + we have found a user that matches the credentials, just res.send back <code class="language-text">hi you are logged in!</code>. Otherwise, just res.send  back "incorrect credentials".</li>
</ul>
</li>
</ul>
<p><strong>Checkpoint:</strong></p>
<p>I should be able to do the following:</p>
<p><img src="https://media.giphy.com/media/3fiCFASm87wLEJEPnP/giphy.gif"></p>
<h3>User authentication + Sessions:</h3>
<p>Great...so now we can register users...but how do we actually persist  a "logged in" state across multiple requests? That's where the idea of sessions comes in. A session is essentially a means by which we can actually persist some information about a user (or anything else really) across multiple requests. These sessions can be stored in cookies that  are sent along with the user for every request.</p>
<p>It basically works as follows:</p>
<ul>
<li>User logs in.</li>
<li>Server authenticates user and gives them a unique cookie that has some information stored in it (e.g. an encrypted object that just has the keys { userId: 123455 })</li>
<li>On subsequent requests, the user has this encrypted cookie that it automagically passes to the server upon each POST/GET request. The server then decrypts the cookie, sees that this request came from userId 123455  and knows that the user is actually authenticated</li>
<li>If the user logs out, the server sets the cookie of the user to an empty object so all subsequent requests from the user are not considered authenticated.</li>
</ul>
<p>Now...how do?</p>
<p>Welp, we do via <code class="language-text">cookie-sessions</code></p>
<p>This part is going to be  <em>really</em> guided:</p>
<p>In server.js somewhere near the top do</p>
<p><code class="language-text">var cookieSession = require(&#39;cookie-session&#39;)</code></p>
<p>Then, before you mount any routes, write in the following:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">app.use(cookieSession({
  name: &#39;local-session&#39;,
  keys: [&#39;spooky&#39;],
  maxAge: 24 * 60 * 60 * 1000 // 24 hours
}))</code></pre></div>
<p>This says that all the cookies from the website are encrypted with the key <code class="language-text">spooky</code> and have a maximum age (i.e. maximum life span) of 24 hrs. After that point, they are considered invalid.</p>
<p>Inside of your <code class="language-text">app.post(&#39;/login&#39;...)</code> route, include the following line before any <code class="language-text">res.send</code> calls:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token operator">=</span> result<span class="token punctuation">.</span>username</code></pre></div>
<p>...assuming you are passing in the result of  your User.findOne call in a variable called  <code class="language-text">result</code>.</p>
<p>Now, inside of <code class="language-text">app.get(&#39;/&#39;)</code>, include the line as follows:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Now, after you log in and visit the <code class="language-text">/</code> route, you should see your username console log'ed out :)</p>
<p>Create  a new "GET" route <code class="language-text">/logout</code>, with the following:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Now when you accesss <code class="language-text">/logout</code> you'll invalidate the user session...but what does this mean for the application.</p>
<p>Well...nothing for now, because we haven't implemented any conditional rendering logic for a logged in user to see something different than  a non-logged in user.</p>
<p>To fix this issue, inside of <code class="language-text">app.get(&#39;/&#39;)</code> pass along another variable into our <code class="language-text">res.render</code> call that keeps track of who is logged in</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> questions<span class="token operator">:</span> results<span class="token punctuation">,</span> user<span class="token operator">:</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Inside of <code class="language-text">views/index.html</code> we will wrap our submit form inside of an EJS if statement that will only render if the <code class="language-text">req.session.user</code> object is not an empty string...we will use truthy/falsiness to our advantage.</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>cis197 piazza lite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    &lt;% if (user) { %>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> Hi &lt;%= user %> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      Question: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>question<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Add question<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
    &lt;% } %>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/account/login<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Log in<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span> to submit a question
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
      &lt;% for (q in questions) { %>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>&lt;%= questions[q].questionText %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
      &lt;% } %>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></div>
<p>So...if we expect the following functionality:</p>
<p><img src="https://media.giphy.com/media/iOs4Qahc58YKXsLlGu/giphy.gif"></p>
<h3>Almost there...</h3>
<h4>Routers...</h4>
<p>So we've been clumping all of our routes together into a single <code class="language-text">server.js</code> file and, while that is fine for this application, it can get out of hand really quickly.</p>
<p>Routers are a feature built into express that allows us to group together all routes that handle a specific subset of features under the same url prefix.</p>
<p>So for example: in our application, we have  5 routes (GET/POST signup, GET/POST login, GET logout) that are <em>just</em> dedicated  to account management type things...we should probably segment those routes off into their own little file.</p>
<p>To do so, open up <code class="language-text">routes/account.js</code> and notice the first two lines of that file.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>These lines instantiate  a new express Router.</p>
<p>Before the <code class="language-text">module.exports</code> line, just put in all of the 5 routes dedicated to account management I mentioned above. Just cut them from <code class="language-text">server.js</code> and paste them inside of <code class="language-text">routes/account.js</code> Note that you are most likely going to need to edit and add more require statements (notably you'll need to require the <code class="language-text">User</code> model in  this file). Also note that you will have to replace <code class="language-text">app.whatever(...)</code> with <code class="language-text">router.whatever(...)</code>.</p>
<p>So now...we need to tell the main <code class="language-text">server.js</code> file that these routes exist.</p>
<p>At the top of <code class="language-text">server.js</code> write in the following line</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> accountRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/account.js'</span><span class="token punctuation">)</span></code></pre></div>
<p>and after the app get and post routes for <code class="language-text">/</code>, just write in the following line:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/account'</span><span class="token punctuation">,</span> accountRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Now,  we will be able to access our account routes at the following urls:</p>
<ul>
<li>localhost:3000/account/signup</li>
<li>localhost:3000/account/login</li>
<li>localhost:3000/account/logout</li>
</ul>
<p>See what the router allowed us to do? It allowed us to segment  off a subset of routes and just append  a url prefix to all of them so it is super clear exactly what the organization of our application looks like.</p>
<p>Now add <code class="language-text">signup, login, and logout</code> lines to index.html with the appropriate route urls.</p>
<h4>Middlewares</h4>
<p>As mentioned in class, a middleware is a function that executes before a certain subset (or all) of the requests that go into our application. This is useful for checking  things like whether is user is authenticated  or not and handling errors  in our application.</p>
<h5>isAuthenticated:</h5>
<p>Let's  implement our first middleware function. This middlware  will check a requests to the <code class="language-text">POST /</code> route and the <code class="language-text">GET /logout</code> route to see whether a user is authenticated or not before executing  those route functions.  If the user is not authenticated, we will send them a message saying  they need to be authenticated to access the route.</p>
<p>Inside of <code class="language-text">middlewares/isAuthenticated</code> paste in the following:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">isAuthenticated</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"you aren't authenticated"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> isAuthenticated<span class="token punctuation">;</span></code></pre></div>
<p>Here we create a  function <code class="language-text">isAuthenticated</code>. The function checks to  see if a user is defined on the session object. If it is, then we allow the request to continue without any error parameters passed on (just by calling <code class="language-text">next()</code>). Otherwise, we send to the user that  they aren't authenticated, thus cutting short any request to the route that  the middleware is supposed to protect.</p>
<p>Right now, this middleware is just a function definition. To actually execute this on some routes, we need to do the following:</p>
<p>On the <code class="language-text">app.post(&#39;/&#39;, function(req, res, next) { ... })</code> route, add an argument after the <code class="language-text">/</code> as follows:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> isAuthenticated<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Similarly for the <code class="language-text">/account/logout</code> route, we need to add in the <code class="language-text">isAuthenticated</code> middleware in a similar fashion.</p>
<p>Note that for both of these you will need to  require the <code class="language-text">isAuthenticated</code> function definition at the top of the appropriate files.</p>
<p>So we expect the following behavior at this point:</p>
<p><img src="https://media.giphy.com/media/8BlUxcekYO9E4zbZX9/giphy.gif"></p>
<h4>Error  Handling:</h4>
<p>Okay this is the last part-ish.</p>
<p>We have a slight problem...</p>
<p>Any time we want to handle errors, we always just send back to the user a <code class="language-text">res.send(&#39;whatever the error message is here&#39;)</code> however, that just leads to a bunch of repetitive calls to handle error logic. How about we have a simple function that just handles any error that comes by us and displays that error. We  can use a middleware for this as well...</p>
<p>If you notice, there are a few lines at the bottom of <code class="language-text">server.js</code></p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'ERROR :  '</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>This is actually a middleware. It isn't as formally defined as our <code class="language-text">isAuthenticated</code> middleware, <em>but</em> it is still middleware regardless (for those who are curious, any  time you do <code class="language-text">app.use</code> something, it is pretty much a middleware or router). Note that since this is at the bottom of the server.js file, it is a function that gets executed after all other requests have been processed (i.e. there's nothing after this).</p>
<p>This middleware  has an additional parameter, <code class="language-text">err</code> that accepts any errors that are passed into this function and  then just send back to the user <code class="language-text">&#39;ERROR: &#39; + err.message</code></p>
<p>But how do we get errors to be passed to this middleware? You may initially be tempted to just throw errors in our route handlers</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/bleh'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// something  went wrong</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'ERROR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>However, when this actually throws an error in the express process itself and causes the server to quit. This isn't quite what we want (rather we just want to display the error to the user).</p>
<p>So to do so, we take advantage of the <code class="language-text">next</code> parameter we've been appending to our route handlers.</p>
<p>Whenever we want to throw an error, we should just call <code class="language-text">next(new Error(&#39;error message&#39;))</code> in a route handler. This error will propagate down into any subsequent handlers until we hit  our last middleware (the one at the bottom of server.js).</p>
<p>An example of this is as follows:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> questionDb <span class="token operator">=</span> Question<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> results</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> questions<span class="token operator">:</span> results<span class="token punctuation">,</span> user<span class="token operator">:</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// we just pass in the error from the db call</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>We can even edit our previous <code class="language-text">isAuthenticated</code> middleware function declaration to take advantage of the middleware!</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">isAuthenticated</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// res.send("you aren't authenticated")</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'you are not authenticated'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> isAuthenticated<span class="token punctuation">;</span></code></pre></div>
<p><strong>TODO:</strong> Go through your application and figure out places where we <code class="language-text">res.send</code>ed any errors. Convert those <code class="language-text">res.send</code> calls to the appropriate <code class="language-text">next(...)</code> calls. <strong>Note</strong>: If your previous  route handlers don't have a <code class="language-text">next</code> property as their 3rd argument (after req, res), just add that in real quick :)</p>
<h2>Deploying on Heroku &#x26; Submission</h2>
<p>And now...we are done!-ish</p>
<p>Let's actually share this application with our friends :) (And the TAs)</p>
<p>Create a heroku account and verify it (add a credit card). If you do need help on verification (or would like a credit card to register under, make a private piazza post).</p>
<p>Install  the <a href="https://devcenter.heroku.com/articles/heroku-cli">heroku CLI</a></p>
<p>Log  in via the CLI.</p>
<p>In your  current directory, create a new git repository with <code class="language-text">git init</code>. Once you have done this, add all files, except the <code class="language-text">node_modules</code> folder, to the commit stage (<code class="language-text">git add filename1 filename2 folder1 ...</code>) and make a new commit
<code class="language-text">git commit -m &quot;initialize&quot;</code>.</p>
<p>Now...<strong>you need to make sure that your package.json file has all the dependencies that are actually required for your app to run</strong>. If a dependency (eg express) isn't there, run (e.g.) <code class="language-text">npm install --save express</code>.</p>
<p>Of course, with any new file change, you need to add it (in this case <code class="language-text">git add package.json</code>) and commit it (<code class="language-text">git commit -m &quot;updated package.json with new dependencies&quot;</code>).</p>
<p>Almost there...</p>
<p>Run <code class="language-text">heroku create yourpennkey-cis197-f18-hw5</code> (e.g. <code class="language-text">suria-cis197-f18-hw5</code>) and then run <code class="language-text">git push heroku master</code>.</p>
<p>Once that is done (hopefully there aren't any errors), we need to tell heroku to make a database</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">heroku addons:create mongolab</code></pre></div>
<p>and then do <code class="language-text">heroku restart</code></p>
<p>If you visit your website <code class="language-text">suria-cis197-f18-hw5.herokuapp.com</code> it <em>should</em> work!</p>
<h3>Submission instructions</h3>
<p>Before you do anything, create a file <code class="language-text">heroku_url.txt</code> in the top level directory of your code (same level as <code class="language-text">server.js</code>). Just copy paste in the link to the heroku app and save the file.</p>
<p>Submit the following files to gradescope. There are a few automated tests to just check that you have the files we want to look at.</p>
<p><img src="https://i.imgur.com/MBct1T3.png" alt="img"></p>
<h4>Rubric</h4>
<p>The main things we will look for are as follows:</p>
<ul>
<li>User signup/login valid: [5pts]</li>
<li>Adding questions restricted to users only: [2pts]</li>
<li>/account/logout link is authentication protected. [2pts]</li>
<li>Persistent questions database. [5pts]</li>
<li>Able to display questions upon  submission of new question [3pts]</li>
<li>
<p>Files:</p>
<ul>
<li>There should be evidence that middlewares were implemented (isAuthenticated) [2pts]</li>
<li>There should be a routes/account file and the account routes should be appropriately mounted [2pts]</li>
<li>There should be evidence of a database models for Users and  Questions. [2pts]</li>
</ul>
</li>
<li>
<p>UX:</p>
<ul>
<li>Evident links to login, signup, sign in and homepage (just enough so that we can navigate around, this isn't shown in the writeup...but we'll give you freedom on how you choose to implement this). [2pts]</li>
</ul>
</li>
</ul></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/assignments/5";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-9cbc32572977ab7faa41.js"],"component---src-templates-markdown-js":["/component---src-templates-markdown-js-69fedeea123282261fbd.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9961d5c9866f9c61253a.js"],"component---src-pages-assignments-js":["/component---src-pages-assignments-js-57bdb2923c8e8a2747df.js"],"component---src-pages-lectures-js":["/component---src-pages-lectures-js-8785743dbe201a5a44ad.js"],"component---src-pages-staff-js":["/component---src-pages-staff-js-8f7aca195e0d0ac5592b.js"]};/*]]>*/</script><script src="/programacao-para-internet-i/webpack-runtime-bf342d3b34a971271ccc.js" async=""></script><script src="/programacao-para-internet-i/framework-e43bc979b16dd68f6b5c.js" async=""></script><script src="/programacao-para-internet-i/styles-36681512479a843831b0.js" async=""></script><script src="/programacao-para-internet-i/commons-2d3c9d9b2e097061f5b5.js" async=""></script><script src="/programacao-para-internet-i/component---src-templates-markdown-js-69fedeea123282261fbd.js" async=""></script><script src="/programacao-para-internet-i/app-9cbc32572977ab7faa41.js" async=""></script></body></html>